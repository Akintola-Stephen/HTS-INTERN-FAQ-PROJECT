USE [FAQ-System]
GO
/****** Object:  StoredProcedure [dbo].[ADMIN_USER_MODULE_OPERATION]    Script Date: 26/04/2021 10:29:49 am ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[ADMIN_USER_MODULE_OPERATION]

	@JSON_STRING VARCHAR(MAX), @ACTION_TYPE VARCHAR(50)
	
AS 
BEGIN
	IF @ACTION_TYPE= 'INSERT'
	BEGIN 
		INSERT INTO SETUP_USER(USERNAME, [PASSWORD], DATE_CREATED, ROLE_ID)
		SELECT  USERNAME, [PASSWORD], DATE_CREATED, ROLE_ID
		FROM OPENJSON(@JSON_STRING)
		WITH 
		(
			USERNAME VARCHAR(20) '$.USERNAME',
			[PASSWORD] VARCHAR(20) '$.[PASSWORD]',
			DATE_CREATED DATETIME '$.DATE_CREATED',
			ROLE_ID INT '$.ROLE_ID'
		)

		SELECT 1 AS OUTPUT_NUMBER, 'Transaction Successful!' AS OUTPUT_MESSAGE
	END

	ELSE IF @ACTION_TYPE = 'UPDATE'
	BEGIN
		UPDATE 
			SETUP_USER
		SET 
			USERNAME = JSON_VALUE(@JSON_STRING, '$[0].USERNAME'),
			[PASSWORD] =  JSON_VALUE(@JSON_STRING,'$[0].[PASSWORD]'),
			ROLE_ID = JSON_VALUE(@JSON_STRING, '$[0].ROLE_ID')
		WHERE 
			USERID = JSON_VALUE(@JSON_STRING, '$[0].USERID')

			SELECT 1 AS OUTPUT_NUMBER, 'Transaction Successfully Updated!' AS OUTPUT_MESSAGE
	END

	ELSE IF @ACTION_TYPE = 'SELECT'
	BEGIN
		SELECT USERNAME, [PASSWORD], DATE_CREATED, (SELECT ROLE_NAME FROM SETUP_ROLE WHERE ROLE_ID = U.ROLE_ID) AS ROLE_NAME 
			FROM SETUP_USER U
	END
	ELSE IF @ACTION_TYPE = 'DELETE'
	BEGIN 
			DELETE FROM SETUP_USER
			WHERE USERID = JSON_VALUE(@JSON_STRING, '$[0].USERID')

			SELECT 1 AS OUTPUT_NUMBER, 'Transaction Successfully Deleted!' AS OUTPUT_MESSAGE

	END

END


